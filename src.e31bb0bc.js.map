{"version":3,"sources":["scripts/helper.js","scripts/preprocess.js","scripts/grouped-quantile.js","index.js"],"names":["generateMapG","width","height","d3","select","append","attr","generateMarkerG","setCanvasSize","appendGraphLabels","g","initPanelDiv","style","getSimulation","data","forceSimulation","features","alphaDecay","velocityDecay","force","forceCollide","strength","simulate","simulation","on","selectAll","d","x","y","getProjection","geoMercator","center","scale","getPath","projection","geoPath","getClosestStep","nSteps","domain","BEST_STEPS","step","stepDiff","bestStep","length","i","push","Math","abs","getSteps","steps","firstStep","floor","unshift","getQuantiles","array","sort","ascending","quantiles","quantile","median","addDayType","jour_semaine","date","getDay","type_jour","isNaN","voyage","ferie","aggregateData","csvData","vizData","startDate","endDate","typeJour","ligne","girouettes","posLigne","findIndex","e","posGirouette","girouette","Girouette","voyages","posVoyage","arrets","posArret","codeArret","arret_code","nomArret","arret_nom","sequenceArret","sequence_arret","minutesEcart","moyMinutesEcart","nClients","moyNClients","ponctualite","tauxPonctualite","minutesEcartClient","moyMinutesEcartClient","Minutes_ecart_planifie","montants","Etat_Ponctualite","average","arr","reduce","a","b","toFixed","computeTauxPonctualite","filter","forEach","arret","MARGIN","top","right","bottom","left","FONT_SIZE","DIRECTIONS_ANGLE","QUANTILE_STROKE_COLOR","QUANTILE_FILL_COLOR","QUANTILE_STROKE_WIDTH","NUMBER_OF_TICKS","GRADIENT_COLORS","GRADIENT_THRESHOLDS","generateViz3","container","delayGraphContainer","trafficGraphContainer","lines","directions","ResizeObserver","generateDelayGraph","observe","node","generateTrafficGraph","quantileSets","getDelayQuantileSets","title","generateGroupedQuantileGraph","svg","dataScale","HEIGHT","getBoundingClientRect","WIDTH","min","enter","insert","text","legend","middleY","squareWidth","paddingX","paddingY","getTrafficQuantileSets","html","BAR_WIDTH","linesScale","scaleOrdinal","range","directionsRange","line","directionsScale","maxValue","Number","MIN_SAFE_INTEGER","minValue","MAX_SAFE_INTEGER","scaleLinear","xAxis","lineValuesY","directionValuesY","yAxis","helper","bars","q3","q2","q1","j","round","direction","delays","trip","stop","tripNClients","svgSize","Date","build","csv","then","arret_Latitude","arret_Longitude","preprocess","groupedQuantile"],"mappings":"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D1CU,EAAlB,CC0CmB,CAACxC,CAAC,CAACwC,MAAd;AACAxC,AD1CR,ADmCO,ICnCD6F,IC0CE7F,CAAC,AFPO0C,CEONmB,UAAF,AD1Cc,EDmCf,CEOgB,AD1CE,ADmCMlB,CEOP3C,AD1CE,CC0CD,CAAC6D,AD1C1B,IDmCO,EAAiCjB,IEOhC,GFPD,EAA0CC,SAA1C,EAAqDC,OAArD,EAA8DC,QAA9D,EAAwEN,KAAxE,EAA+E;AEQ9EzC,AD1CR,AFkCO,ACCL,ICnCI8F,IC0CE9F,CAAC,AHROlB,CGQN6F,QAAF,GAAa,CAAC3E,AHRf,CGQgB,AHRQzB,CGQPoG,CD1CG,GAAG,AFkCvB,EAA+BnG,EGQ9B,GD1CR,CFkCO,EAAuC;AGStCwB,AD1CR,AFkCEvB,ACCA,EDDAA,EElCIsH,AFkCF,CAACrH,ECCE,CEOCsB,CAAC,CAAC0E,CHRR,ACCSxD,CDDC,ACCA,GAAG,CAAb,EDDA,ACCgBA,CAAC,CDDCxC,ECCEiE,CCnCG,GAAG,AFkC1B,CAAyB,ECCE,CAAC1B,EEOtB,AHRN,EACGrC,CGO8B,CAACoB,AFPlC,CEOmC,AD1CrC,CC0CsC0E,AHRpC,ACCoCxD,CDA5B,ACA6B,EAArC,EAAyC,GDDzC,EACiB3C,KADjB,EAEGK,IAFH,CGQM,AHNE,QAFR,EAEkBJ,MAFlB;AGSMwB,AD1CR,AFoCC,ACDG,ICnCEgG,IC0CEhG,AFPA2C,CEOC,CAACsB,KFPK,CAAC/C,CAAD,CAAP,CAAWkB,IAAX,CEOA,CD1CmB,EC0CA,AFPAS,CEOC7C,AD1CE,CC0CD,AD1C7B,CC0C8BiE,MFPtB,IAAgCtB,IEOhC,GFPuC,CAACzB,CAAD,CAAP,CAAWkB,IAAX,IAAmBU,OAAnD,IAA8DH,OAAO,CAACzB,CAAD,CAAP,CAAWoB,SAAX,KAAyBS,QAAvF,IAAmGJ,OAAO,CAACzB,CAAD,CAAP,CAAWuB,KAAX,KAAqBA,KAA5H,EAAmI;AEQ/HzC,AD1CR,AFqCA,ACFM,ICnCAiG,IC0CEjG,CAAC,CAACqK,AFPAzH,OAAO,CAAC3B,CCnCG,GAAG,EC0ChB,AD1CR,ADmCU,GEOiB,CAACjB,CAAC,AFPA,CEOCqK,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ADnCW,CAAP,CCoCDtE,ADpCmBqE,ICmCtB,CACQ,KDpCJ,CAA6BI,CCmCjC,EACiByE,SDpCb,ECmCJ,ADnC+CtE,ECqC5C5E,IAFH,CAEQ,ADrCJ,CAAmD6E,ECmCvD,EAEa8D,KAAK,ADrCd,EAA8D7D,CCqC7C6B,KDrCjB,CCqCuB,ADrC8C5B,CCqC7C8B,KAAf,EDrCT,CCqCgCG,CDrC+CxB,QCmCnF,ADnCI,CAAwFjD,CCsCzFvC,GDtCC,CCmCJ,ADnCiG+D,CCsCzF,MDtCgG,CAACzB,CCmCzG,ADnCwG,CAAP,CCsC/E4G,ADtC0FnD,QAAxG,GCmCJ,EAIG/F,IAJH,CAIQ,GAJR,EAIaiJ,OAAO,GAAGG,QAJvB,EAKGpJ,IALH,CAKQ,QALR,EAKkBkH,qBALlB,EAMGlH,IANH,CAMQ,MANR,EAMgBsH,eAAe,CAAC,CAAD,CAN/B;AAOA0B,AFTF,AChCMhF,ECyCJgF,IDzCIhF,ECyCE,CAACjE,IDzCI,CAACuE,CCyCZ,CAAc,MAAd,ADzCW,CAAP,CC0CDtE,AD1CmBqE,ICyCtB,CACQ,GADR,EACasE,AD1CT,CAA6BlE,IC0Cf,GAAGkC,KD1CjB,CC0CuB,CAACE,AD1CmBjC,KC0ClC,ED1CT,CC0CgCuE,AD1CmBtE,QCyCvD,CDzCI,CC2CD7E,CD3C+D8E,GCyClE,CAEQ,ED3CJ,CCyCJ,ADzCyEC,EC2C5DkE,MD3CT,CC2CgB,CD3C+DvD,EC2C5D0D,QAAV,CD3CT,CAA2F7G,CC2C7D2G,GD3C9B,CAAgGnF,OCyCpG,ADzC2G,CAACzB,CC4CzGyG,AD5CwG,CAAP,CAAW/C,ECyC/G,CAGQ,QAHR,KDzCI;AC6CJgD,AD5CIhF,EC4CJgF,ID5CIhF,EC4CE,CAACjE,ID5CI,CAACuE,CC4CZ,CAAc,MAAd,AD5CW,CAAP,CC6CDtE,AD7CmBqE,IC4CtB,CACQ,KD7CJ,CAA6BI,CC4CjC,EACiByE,SD7Cb,EC4CJ,AD5C+CtE,EC8C5C5E,IAFH,CAEQ,AD9CJ,CAAmD6E,EC4CvD,EAEa8D,KAAK,AD9Cd,EAA8D7D,CC8C7C6B,KD9CjB,CC8CuB,AD9C8C5B,CC8C7C8B,KAAf,ED9CT,CC8CgC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,AC/CEqC,IAAAA,ECqEGmE,AFtBDpG,GEgB0D,AD/DvD,CAACkC,ID+CI,GAAG,EAAf,CC/CE,CAAiBoC,OAAjB,CAAyB,UCsE3B,ADtEqC/B,SAAV,EAAqB;ADgDhD,AC/CIA,MD+CAtC,AC/CAsC,QD+CQ,CC/CC,CAACE,CD+CC3C,MC/CX,CAAkBwE,GD+CG,CAACxE,GC/CtB,CAA0B,MD+CM,CAACI,GC/CGuB,GD+Cd,GAAoB,AC/ChB,CD+CL,CAAzB,AC/CgD;AAC1CA,QAAAA,MAAM,CAACkB,MAAP,CAAc2B,OAAd,CAAsB,UAAUC,KAAV,EAAiB;ACqE7C6B,AFtBA,AC9CQ7B,ECoER6B,GAAG,CAACzI,CFtBC,GC9CG4G,CD8CCpE,CEsBT,AFtBU,CEsBC,EFtBE,AC9CA,CD8Cb,AC9CciD,ED8CEjD,CAAC,GAAGL,SEsBpB,ADpEQ,CD8CsB,CEuB3B8G,AFvB4B1G,CC9CC4D,GCoEhC,CACQ,CFvBR,CEsBA,CFtBuC3D,AC9CA,CD8CC,AC9CAoE,ED8CxC,EAA4C,CC9CC,CAACpB,YAAP,CAA/B;ACsERiD,AFvBEpG,AC9CMuE,ECqER6B,EFvBEpG,CEuBC,CAACrC,IDrEI4G,ECqER,AFvBU,CEuBC,AFvBAnE,EC9CE,CAACkD,CD8CZ,CAAcjD,IAAI,CAACC,GAAL,CAASR,AC9CjB,GAAoBgE,CCqE5B,EACGlG,IFxBgC,AC9CA,CD8CCuC,AC9CAoE,CCqEpC,AFvBmC,CEwBzB,AFxBe,GAAgBxE,AC9CA,CAACsD,GCqE1C,AFvBgB,CAAd,CEyBCxF,GDvEgC,CCqEnC,ADrEQ,CCuEA,GAFR,EAEY,IAFZ,EAGGA,IAHH,CAGQ,GAHR,EAGY,IAHZ,EAIG+I,IAJH,CAIQ,QAJR;AAKAR,ADzEQ7B,ECyER6B,GAAG,CAACzI,IDzEI4G,ECyER,CAAW,EDzEE,CAACb,eCyEd,EACG9F,ID1EK,ECyER,CACU,AD1E4BkG,OCyEtC,ADzE6C,CAACS,CC2E3C1G,IAFH,ADzEmD,CC2E3C,AD3E4C4F,ICyEpD,EAEa,KAFb,EAGG5F,IAHH,CAGQ,AD5EqC,CAArC,GCyER,EAGa,IAHb,EAIG+I,IAJ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","file":"src.e31bb0bc.js","sourceRoot":"..\\src","sourcesContent":["\r\n/**\r\n * Generates the SVG element g which will contain the map base.\r\n *\r\n * @param {number} width The width of the graph\r\n * @param {number} height The height of the graph\r\n * @returns {*} The d3 Selection for the created g element\r\n */\r\nexport function generateMapG (width, height) {\r\n  return d3.select('.graph')\r\n    .select('svg')\r\n    .append('g')\r\n    .attr('id', 'map-g')\r\n    .attr('width', width)\r\n    .attr('height', height)\r\n}\r\n\r\n/**\r\n * Generates the SVG element g which will contain the map markers.\r\n *\r\n * @param {number} width The width of the graph\r\n * @param {number} height The height of the graph\r\n * @returns {*} The d3 Selection for the created g element\r\n */\r\nexport function generateMarkerG (width, height) {\r\n  return d3.select('.graph')\r\n    .select('svg')\r\n    .append('g')\r\n    .attr('id', 'marker-g')\r\n    .attr('width', width)\r\n    .attr('height', height)\r\n}\r\n\r\n/**\r\n * Sets the size of the SVG canvas containing the graph.\r\n *\r\n * @param {number} width The desired width\r\n * @param {number} height The desired height\r\n */\r\nexport function setCanvasSize (width, height) {\r\n  d3.select('#map').select('svg')\r\n    .attr('width', width)\r\n    .attr('height', height)\r\n}\r\n\r\n/**\r\n * Appends the labels for the graph.\r\n *\r\n * @param {*} g The d3 Selection of the graph's g SVG element\r\n */\r\nexport function appendGraphLabels (g) {\r\n /* g.append('text')\r\n    .text('Achalandage et ponctualité des lignes de bus 9 et 22 de la couronne Nord de Montréal')\r\n    .attr('class', 'title')\r\n    .attr('fill', '#000000')\r\n    .attr('font-family', 'myriad-pro')\r\n    .attr('font-size', 28)\r\n    .attr('transform', 'translate(50, 50)')\r\n\r\n  g.append('text')\r\n    .text('Sous-titre')\r\n    .attr('class', 'title')\r\n    .attr('fill', '#000000')\r\n    .attr('font-family', 'myriad-pro')\r\n    .attr('font-size', 18)\r\n    .attr('transform', 'translate(50, 85)') */\r\n}\r\n\r\n/**\r\n * Initializes the div which will contain the information panel.\r\n */\r\nexport function initPanelDiv () {\r\n  d3.select('.graph')\r\n    .append('div')\r\n    .attr('id', 'panel')\r\n    .style('width', '215px')\r\n    .style('border', '1px solid black')\r\n    .style('padding', '10px')\r\n    .style('visibility', 'hidden')\r\n}\r\n\r\n/**\r\n * Initializes the simulation used to place the circles\r\n *\r\n * @param {object} data The data to be displayed\r\n * @returns {*} The generated simulation\r\n */\r\nexport function getSimulation (data) {\r\n  return d3.forceSimulation(data.features)\r\n    .alphaDecay(0)\r\n    .velocityDecay(0.75)\r\n    .force('collision',\r\n      d3.forceCollide(5)\r\n        .strength(1)\r\n    )\r\n}\r\n\r\n/**\r\n * Update the (x, y) position of the circles'\r\n * centers on each tick of the simulation.\r\n *\r\n * @param {*} simulation The simulation used to position the cirles.\r\n */\r\nexport function simulate (simulation) {\r\n  simulation.on('tick', () => {\r\n    d3.selectAll('.marker')\r\n      .attr('cx', (d) => d.x)\r\n      .attr('cy', (d) => d.y)\r\n  })\r\n}\r\n\r\n/**\r\n * Sets up the projection to be used.\r\n *\r\n * @returns {*} The projection to use to trace the map elements\r\n */\r\nexport function getProjection () {\r\n  return d3.geoMercator()\r\n    .center([-73.708879, 45.579611])\r\n    .scale(70000)\r\n}\r\n\r\n/**\r\n * Sets up the path to be used.\r\n *\r\n * @param {*} projection The projection used to trace the map elements\r\n * @returns {*} The path to use to trace the map elements\r\n */\r\nexport function getPath (projection) {\r\n  return d3.geoPath()\r\n    .projection(projection)\r\n}\r\n\r\n/**\r\n * @param {number} nSteps The ideal number of steps\r\n * @param {*} domain Domain of d3 scale\r\n * @returns {number} The best step to use\r\n */\r\nexport function getClosestStep (nSteps, domain) {\r\n  const BEST_STEPS = [\r\n    0.1, 0.2, 0.25, 0.5,\r\n    1, 2, 2.5, 5,\r\n    10, 20, 25, 50,\r\n    100, 200, 250, 500,\r\n    1000, 2000, 2500, 5000,\r\n    10000, 20000, 25000, 50000\r\n  ]\r\n  var step = (domain[1] - domain[0]) / nSteps\r\n  var stepDiff = []\r\n  var bestStep = BEST_STEPS[BEST_STEPS.length - 1]\r\n  for (let i = 0; i < BEST_STEPS.length; i++) {\r\n    stepDiff.push(Math.abs(BEST_STEPS[i] - step))\r\n    if (i > 0 && stepDiff[i] > stepDiff[i - 1]) {\r\n      bestStep = BEST_STEPS[i - 1]\r\n      break\r\n    }\r\n  }\r\n  return bestStep\r\n}\r\n\r\n/**\r\n * @param {number} nSteps The ideal number of steps\r\n * @param {*} domain Domain of d3 scale\r\n * @returns {Array<number>} The best steps\r\n */\r\nexport function getSteps (nSteps, domain) {\r\n  var step = getClosestStep(nSteps, domain)\r\n  var steps = []\r\n  if (domain[0] <= 0 && domain[1] >= 0) {\r\n    steps.push(0)\r\n  } else {\r\n    let firstStep = Math.floor(domain[0])\r\n    while (firstStep % step !== 0) {\r\n      firstStep += 1\r\n    }\r\n    steps.push(firstStep)\r\n  }\r\n  while (steps[steps.length - 1] < domain[1] - step) {\r\n    steps.push(steps[steps.length - 1] + step)\r\n  }\r\n  while (steps[0] > domain[0] + step) {\r\n    steps.unshift(steps[0] - step)\r\n  }\r\n  return steps\r\n}\r\n\r\n/**\r\n * @param {Array<number>} array Array of numeric values\r\n * @returns {Array<number>} The quantiles\r\n */\r\nexport function getQuantiles (array) {\r\n  array = array.sort(d3.ascending)\r\n  const quantiles = [\r\n    array[0],\r\n    d3.quantile(array, 0.25),\r\n    d3.median(array),\r\n    d3.quantile(array, 0.75),\r\n    array[array.length - 1]\r\n  ]\r\n  return quantiles\r\n}\r\n","// INF8808 - Exo\r\n//\r\n// Adam Prévost - 1947205\r\n// Armelle Jézéquel - 2098157\r\n// Clara Serruau - 2164678\r\n// Jules Lefebvre - 1847158\r\n// Julien Dupuis - 1960997\r\n//\r\n\r\n/**\r\n * Ajout de champs à l'objet\r\n * jour_semaine {0, 1, 2, 3, 4, 5, 6} où 0 = Dimanche\r\n * type_jour {semaine, fin de semaine}\r\n * ferie {true, false}\r\n *\r\n * @param {object[]} data L'array d'objets qui contient les lignes du csv\r\n */\r\n export function addDayType (data) {\r\n  for (var i = 0; i < data.length; i++) {\r\n    // jour_semaine\r\n    data[i].jour_semaine = data[i].date.getDay()\r\n\r\n    // type_jour\r\n    data[i].jour_semaine === (0 || 6) ? data[i].type_jour = 'fin de semaine' : data[i].type_jour = 'semaine'\r\n\r\n    // ferie\r\n    isNaN(data[i].voyage) ? data[i].ferie = true : data[i].ferie = false\r\n  }\r\n}\r\n/**\r\n * aggregateData() remplit l'objet vizData à partir des données du csv (data)\r\n *\r\n * @param {*} csvData L'array d'objets qui contient les lignes du csv, modifié par preprocess.addDayType()\r\n * @param {*} vizData L'array d'objets qui contient les données consolidées requises pour générer les viz\r\n * @param {*} startDate Date de début\r\n * @param {*} endDate Date de fin\r\n * @param {*} typeJour On considère semaine ou weekend\r\n * @param {*} ferie On considère les fériés si true\r\n */\r\nexport function aggregateData (csvData, vizData, startDate, endDate, typeJour, ferie) {\r\n  // Boucle sur les lignes de csvData pour remplir la structure vizData\r\n  for (var i = 0; i < csvData.length; i++) {\r\n    if (csvData[i].date >= startDate && csvData[i].date <= endDate && csvData[i].type_jour === typeJour && csvData[i].ferie === ferie) {\r\n      if (vizData.length === 0) {\r\n        vizData.push({ ligne: csvData[i].ligne, girouettes: [] })\r\n      }\r\n\r\n      // On ajoute la ligne si elle n'existe pas déjà dans vizData\r\n      var posLigne = vizData.findIndex(e => e.ligne === csvData[i].ligne)\r\n      if (posLigne === -1) {\r\n        vizData.push({ ligne: csvData[i].ligne, girouettes: [] })\r\n        posLigne = vizData.length - 1\r\n      }\r\n\r\n      // On ajoute la girouette si elle n'existe pas déjà dans vizData\r\n      var posGirouette = vizData[posLigne].girouettes.findIndex(e => e.girouette === csvData[i].Girouette)\r\n      if (posGirouette === -1) {\r\n        vizData[posLigne].girouettes.push({ girouette: csvData[i].Girouette, voyages: [] })\r\n        posGirouette = vizData[posLigne].girouettes.length - 1\r\n      }\r\n\r\n      // On ajoute le voyage s'il n'existe pas déjà dans vizData\r\n      var posVoyage = vizData[posLigne].girouettes[posGirouette].voyages.findIndex(e => e.voyage === csvData[i].voyage)\r\n      if (posVoyage === -1) {\r\n        vizData[posLigne].girouettes[posGirouette].voyages.push({ voyage: csvData[i].voyage, arrets: [] })\r\n        posVoyage = vizData[posLigne].girouettes[posGirouette].voyages.length - 1\r\n      }\r\n\r\n      // On ajoute l'arrêt s'il n'existe pas déjà dans vizData\r\n      var posArret = vizData[posLigne].girouettes[posGirouette].voyages[posVoyage].arrets.findIndex(e => e.codeArret === csvData[i].arret_code)\r\n      if (posArret === -1) {\r\n        vizData[posLigne].girouettes[posGirouette].voyages[posVoyage].arrets.push(\r\n          {\r\n            codeArret: csvData[i].arret_code,\r\n            nomArret: csvData[i].arret_nom,\r\n            sequenceArret : csvData[i].sequence_arret,\r\n            minutesEcart: [],\r\n            moyMinutesEcart: null,\r\n            nClients: [],\r\n            moyNClients: null,\r\n            ponctualite: [],\r\n            tauxPonctualite: null,\r\n            minutesEcartClient: [],\r\n            moyMinutesEcartClient: null\r\n          })\r\n        posArret = vizData[posLigne].girouettes[posGirouette].voyages[posVoyage].arrets.length - 1\r\n      }\r\n\r\n      vizData[posLigne].girouettes[posGirouette].voyages[posVoyage].arrets[posArret].minutesEcart.push(csvData[i].Minutes_ecart_planifie)\r\n      vizData[posLigne].girouettes[posGirouette].voyages[posVoyage].arrets[posArret].nClients.push(csvData[i].montants)\r\n      vizData[posLigne].girouettes[posGirouette].voyages[posVoyage].arrets[posArret].ponctualite.push(csvData[i].Etat_Ponctualite)\r\n      vizData[posLigne].girouettes[posGirouette].voyages[posVoyage].arrets[posArret].minutesEcartClient.push(csvData[i].Minutes_ecart_planifie * csvData[i].montants)\r\n    }\r\n  }\r\n\r\n  // Fonctions pour créer les indicateurs\r\n  const average = arr => +(arr.reduce((a, b) => a + b, 0) / arr.length).toFixed(2) // https://poopcode.com/calculate-the-average-of-an-array-of-numbers-in-javascript/\r\n  const computeTauxPonctualite = arr => arr.filter(x => x === 'Ponctuel').length / arr.length\r\n\r\n  // Parcours de vizData pour calculer les indicateurs pour chaque ligne.arret\r\n  vizData.forEach(function (ligne) {\r\n    ligne.girouettes.forEach(function (girouette) {\r\n      girouette.voyages.forEach(function (voyage) {\r\n        voyage.arrets.forEach(function (arret) {\r\n          arret.moyMinutesEcart = average(arret.minutesEcart)\r\n          arret.moyNClients = average(arret.nClients)\r\n          arret.moyMinutesEcartClient = average(arret.minutesEcartClient)\r\n          arret.tauxPonctualite = computeTauxPonctualite(arret.ponctualite)\r\n        })\r\n      })\r\n    })\r\n  })\r\n}\r\n","import * as helper from './helper.js'\r\n\r\nconst MARGIN = { top: 52, right: 100, bottom: 125, left: 100 }\r\nconst FONT_SIZE = 14\r\nconst DIRECTIONS_ANGLE = -45\r\nconst QUANTILE_STROKE_COLOR = 'black'\r\nconst QUANTILE_FILL_COLOR = 'lightgray'\r\nconst QUANTILE_STROKE_WIDTH = 2\r\nconst NUMBER_OF_TICKS = 10\r\nconst GRADIENT_COLORS = ['#ff9999', '#99ff99', '#ffff99']\r\nconst GRADIENT_THRESHOLDS = ['10', '5', '0', '-5']\r\n\r\n/**\r\n * @param vizData\r\n */\r\nexport function generateViz3 (vizData) {\r\n  // Split container in two\r\n  var container = d3.select('#grouped-quantile-graph-container')\r\n  var delayGraphContainer = container.append('div')\r\n    .style('width', '50%')\r\n    .style('height', '100%')\r\n    .style('float', 'left')\r\n  var trafficGraphContainer = container.append('div')\r\n    .style('width', '50%')\r\n    .style('height', '100%')\r\n    .style('float', 'right')\r\n\r\n  // TODO: Fetch data\r\n  var data = {}\r\n  data.lines = ['9', '22']\r\n  data.directions = ['Lafontaine', 'Montmorency', 'Côté', 'George VI']\r\n\r\n  // Regenerate graphs on resize\r\n  new ResizeObserver(() => { generateDelayGraph(delayGraphContainer, data, vizData) })\r\n    .observe(delayGraphContainer.node())\r\n  new ResizeObserver(() => { generateTrafficGraph(trafficGraphContainer, data, vizData) })\r\n    .observe(trafficGraphContainer.node())\r\n}\r\n\r\n/**\r\n * @param {Selection} container The div to generate the graph in\r\n * @param {object} data The data to fetch\r\n * @param vizData\r\n */\r\nexport function generateDelayGraph (container, data, vizData) {\r\n  // Fetch data\r\n  data.quantileSets = getDelayQuantileSets(vizData)\r\n\r\n  // Generate common graph\r\n  data.title = 'Retard Moyen'\r\n  var [svg, dataScale] = generateGroupedQuantileGraph(container, data)\r\n  var HEIGHT = container.node().getBoundingClientRect().height\r\n  var WIDTH = Math.min(HEIGHT, container.node().getBoundingClientRect().width)\r\n\r\n  // Set gradients\r\n  svg.append('defs')\r\n    .append('linearGradient')\r\n    .attr('id', 'late-grad')\r\n    .attr('x1', '0%')\r\n    .attr('x2', '0%')\r\n    .attr('y1', '0%')\r\n    .attr('y2', '100%')\r\n    .selectAll('stop')\r\n    .data([GRADIENT_COLORS[0], GRADIENT_COLORS[1]])\r\n    .enter()\r\n    .append('stop')\r\n    .style('stop-color', function (d) { return d })\r\n    .attr('offset', function (d, i) { return 100 * i + '%' })\r\n  svg.append('defs')\r\n    .append('linearGradient')\r\n    .attr('id', 'early-grad')\r\n    .attr('x1', '0%')\r\n    .attr('x2', '0%')\r\n    .attr('y1', '0%')\r\n    .attr('y2', '100%')\r\n    .selectAll('stop')\r\n    .data([GRADIENT_COLORS[1], GRADIENT_COLORS[2]])\r\n    .enter()\r\n    .append('stop')\r\n    .style('stop-color', function (d) { return d })\r\n    .attr('offset', function (d, i) { return 100 * i + '%' })\r\n  // Draw gradients\r\n  svg.insert('rect', '#x-axis')\r\n    .attr('width', WIDTH - MARGIN.left - MARGIN.right)\r\n    .attr('x', MARGIN.left)\r\n    .attr('height', dataScale(GRADIENT_THRESHOLDS[0]) - MARGIN.top)\r\n    .attr('y', MARGIN.top)\r\n    .attr('fill', GRADIENT_COLORS[0])\r\n  svg.insert('rect', '#x-axis')\r\n    .attr('width', WIDTH - MARGIN.left - MARGIN.right)\r\n    .attr('x', MARGIN.left)\r\n    .attr('height', dataScale(GRADIENT_THRESHOLDS[1]) - dataScale(GRADIENT_THRESHOLDS[0]))\r\n    .attr('y', dataScale(GRADIENT_THRESHOLDS[0]))\r\n    .attr('fill', 'url(#late-grad)')\r\n  svg.insert('rect', '#x-axis')\r\n    .attr('width', WIDTH - MARGIN.left - MARGIN.right)\r\n    .attr('x', MARGIN.left)\r\n    .attr('height', dataScale(GRADIENT_THRESHOLDS[2]) - dataScale(GRADIENT_THRESHOLDS[1]))\r\n    .attr('y', dataScale(GRADIENT_THRESHOLDS[1]))\r\n    .attr('fill', GRADIENT_COLORS[1])\r\n  svg.insert('rect', '#x-axis')\r\n    .attr('width', WIDTH - MARGIN.left - MARGIN.right)\r\n    .attr('x', MARGIN.left)\r\n    .attr('height', dataScale(GRADIENT_THRESHOLDS[3]) - dataScale(GRADIENT_THRESHOLDS[2]))\r\n    .attr('y', dataScale(GRADIENT_THRESHOLDS[2]))\r\n    .attr('fill', 'url(#early-grad)')\r\n  svg.insert('rect', '#x-axis')\r\n    .attr('width', WIDTH - MARGIN.left - MARGIN.right)\r\n    .attr('x', MARGIN.left)\r\n    .attr('height', HEIGHT - MARGIN.bottom - dataScale(GRADIENT_THRESHOLDS[3]))\r\n    .attr('y', dataScale(GRADIENT_THRESHOLDS[3]))\r\n    .attr('fill', GRADIENT_COLORS[2])\r\n\r\n  // Set y axis label\r\n  svg.select('#y-axis > .label')\r\n    .text('Minute')\r\n    .attr('fill', '#898989')\r\n\r\n  // Legend\r\n  const legend = svg.insert('g', '#x-axis').style(\"font-size\",\"12px\")\r\n  const middleY = (HEIGHT - MARGIN.top - MARGIN.bottom) / 2 + MARGIN.top\r\n  const squareWidth = FONT_SIZE * 2 / 3\r\n  const paddingX = FONT_SIZE * 2\r\n  const paddingY = FONT_SIZE * 1.5\r\n  legend.append('rect')\r\n    .attr('width', squareWidth)\r\n    .attr('x', WIDTH - MARGIN.right + FONT_SIZE)\r\n    .attr('height', squareWidth)\r\n    .attr('y', middleY - paddingY)\r\n    .attr('stroke', QUANTILE_STROKE_COLOR)\r\n    .attr('fill', GRADIENT_COLORS[0])\r\n  legend.append('text')\r\n    .attr('x', WIDTH - MARGIN.right + paddingX)\r\n    .attr('y', middleY - paddingY + squareWidth)\r\n    .text('Retard')\r\n  legend.append('rect')\r\n    .attr('width', squareWidth)\r\n    .attr('x', WIDTH - MARGIN.right + FONT_SIZE)\r\n    .attr('height', squareWidth)\r\n    .attr('y', middleY)\r\n    .attr('stroke', QUANTILE_STROKE_COLOR)\r\n    .attr('fill', GRADIENT_COLORS[1])\r\n  legend.append('text')\r\n    .attr('x', WIDTH - MARGIN.right + paddingX)\r\n    .attr('y', middleY + squareWidth)\r\n    .text('Ponctuel')\r\n  legend.append('rect')\r\n    .attr('width', squareWidth)\r\n    .attr('x', WIDTH - MARGIN.right + FONT_SIZE)\r\n    .attr('height', squareWidth)\r\n    .attr('y', middleY + paddingY)\r\n    .attr('stroke', QUANTILE_STROKE_COLOR)\r\n    .attr('fill', GRADIENT_COLORS[2])\r\n  legend.append('text')\r\n    .attr('x', WIDTH - MARGIN.right + paddingX)\r\n    .attr('y', middleY + paddingY + squareWidth)\r\n    .text('Avance')\r\n}\r\n\r\n/**\r\n * @param {Selection} container The div to generate the graph in\r\n * @param {object} data The data to fetch\r\n * @param vizData\r\n */\r\nexport function generateTrafficGraph (container, data, vizData) {\r\n  // Fetch data\r\n  data.quantileSets = getTrafficQuantileSets(vizData, 'moyMinutesEcart')\r\n\r\n  // Generate common graph\r\n  data.title = 'Achalandage Moyen'\r\n  var [svg] = generateGroupedQuantileGraph(container, data)\r\n  // Set y axis label\r\n  svg.select('#y-axis > .label')\r\n    .text(\"\")\r\n  svg.select('#y-axis > .label')\r\n    .append('tspan')\r\n    .attr(\"x\",\"88\")\r\n    .attr(\"y\",\"21\")\r\n    .text(\"Nombre\")\r\n  svg.select('#y-axis > .label')\r\n    .append('tspan')\r\n    .attr(\"dx\",\"-51\")\r\n    .attr(\"dy\",\"15\")\r\n    .text(\"de personnes\")\r\n    svg.select('#y-axis > .label')\r\n    .append('tspan')\r\n    .attr(\"dx\",\"-84\")\r\n    .attr(\"dy\",\"14\")\r\n    .text(\"par trajet\")\r\n    /*.text('Nombre de personnes par trajet')\r\n    .attr('fill', '#898989')*/\r\n}\r\n\r\n/**\r\n * @param {Selection} container The div to generate the graph in\r\n * @param {object} data The data to display\r\n * @returns {Selection} The generated graph as svg\r\n */\r\nexport function generateGroupedQuantileGraph (container, data) {\r\n  // ===================== SETUP =====================\r\n\r\n  // Delete existing content\r\n  container.html('')\r\n  // Set size\r\n  var HEIGHT = container.node().getBoundingClientRect().height\r\n  var WIDTH = Math.min(HEIGHT, container.node().getBoundingClientRect().width)\r\n  var BAR_WIDTH = (WIDTH - MARGIN.left - MARGIN.right) / 7\r\n  // Create svg\r\n  var svg = container.append('svg')\r\n    .attr('width', WIDTH)\r\n    .attr('height', HEIGHT)\r\n    .attr('style', 'display: block; margin: auto')\r\n\r\n  // ===================== SCALES =====================\r\n\r\n  // Create lines scale\r\n  var linesScale = d3.scaleOrdinal()\r\n    .domain(data.lines)\r\n    .range([MARGIN.left + 2 * BAR_WIDTH, MARGIN.left + 5 * BAR_WIDTH])\r\n  // Create directions scale\r\n  var directionsRange = []\r\n  for (const line of data.lines) {\r\n    directionsRange.push(linesScale(line) - BAR_WIDTH / 2)\r\n    directionsRange.push(linesScale(line) + BAR_WIDTH / 2)\r\n  }\r\n  var directionsScale = d3.scaleOrdinal()\r\n    .domain([...data.directions])\r\n    .range(directionsRange)\r\n  // Create data scale\r\n  var maxValue = Number.MIN_SAFE_INTEGER\r\n  var minValue = Number.MAX_SAFE_INTEGER\r\n  for (const quantiles of data.quantileSets) {\r\n    for (const quantile of quantiles) {\r\n      if (maxValue < quantile) {\r\n        maxValue = quantile\r\n      }\r\n      if (minValue > quantile) {\r\n        minValue = quantile\r\n      }\r\n    }\r\n  }\r\n  var dataScale = d3.scaleLinear()\r\n    .domain([minValue, maxValue])\r\n    .range([HEIGHT - MARGIN.bottom - FONT_SIZE / 2, MARGIN.top + FONT_SIZE / 2])\r\n\r\n  // ===================== X AXIS =====================\r\n\r\n  var xAxis = svg.append('g')\r\n    .attr('id', 'x-axis')\r\n  // Draw axis line\r\n  xAxis.append('path')\r\n    .attr('d', d3.line()([\r\n      [MARGIN.left, HEIGHT - MARGIN.bottom],\r\n      [MARGIN.left + 7 * BAR_WIDTH, HEIGHT - MARGIN.bottom]\r\n    ]))\r\n    .attr('stroke', 'black')\r\n  // Draw line values\r\n  const lineValuesY = HEIGHT - MARGIN.bottom + FONT_SIZE * 1.5\r\n  for (const line of data.lines) {\r\n    xAxis.append('text')\r\n      .attr('x', linesScale(line))\r\n      .attr('y', lineValuesY)\r\n      .attr('text-anchor', 'middle')\r\n      .text(line)\r\n    .attr('fill', '#898989')\r\n      .style('font-size', FONT_SIZE)\r\n  }\r\n  // Draw direction values\r\n  const directionValuesY = lineValuesY + FONT_SIZE\r\n  for (let i = 0; i < data.directions.length; i++) {\r\n    const x = directionsScale(data.directions[i])\r\n    xAxis.append('text')\r\n      .attr('text-anchor', 'end')\r\n      .attr('transform', `translate(${x}, ${directionValuesY}) rotate(${DIRECTIONS_ANGLE})`)\r\n      .text(data.directions[i])\r\n      .style('font-size', \"12px\")\r\n      .attr('font-family', 'sans-serif')\r\n      .attr('class', `direction${i} label`)\r\n  }\r\n  // Draw labels\r\n  xAxis.append('text')\r\n    .attr('x', WIDTH - MARGIN.right + FONT_SIZE / 2)\r\n    .attr('y', lineValuesY)\r\n    .text('Ligne')\r\n    .attr('fill', '#898989')\r\n    .style('font-size', FONT_SIZE)\r\n  xAxis.append('text')\r\n    .attr('x', WIDTH - MARGIN.right + FONT_SIZE / 2)\r\n    .attr('y', directionValuesY + FONT_SIZE)\r\n    .text('Direction')\r\n    .attr('fill', '#898989')\r\n    .style('font-size', FONT_SIZE)\r\n\r\n  // ===================== Y AXIS =====================\r\n\r\n  var yAxis = svg.append('g')\r\n    .attr('id', 'y-axis')\r\n  // Draw axis line\r\n  yAxis.append('path')\r\n    .attr('d', d3.line()([\r\n      [MARGIN.left, MARGIN.top],\r\n      [MARGIN.left, HEIGHT - MARGIN.bottom]\r\n    ]))\r\n    .attr('stroke', 'black')\r\n  // Generate steps\r\n  var steps = helper.getSteps(NUMBER_OF_TICKS, dataScale.domain())\r\n  for (const step of steps) {\r\n    const y = dataScale(step)\r\n    // Draw data values\r\n    yAxis.append('text')\r\n      .attr('text-anchor', 'end')\r\n      .attr('x', MARGIN.left - FONT_SIZE)\r\n      .attr('y', y + FONT_SIZE / 3)\r\n      .text(step)\r\n      .attr('font-family', 'sans-serif')\r\n      .style('font-size', FONT_SIZE)\r\n    // Draw ticks\r\n    yAxis.append('path')\r\n      .attr('d', d3.line()([\r\n        [MARGIN.left - FONT_SIZE / 2, y],\r\n        [MARGIN.left, y]]\r\n      ))\r\n      .attr('stroke', QUANTILE_STROKE_COLOR)\r\n      .attr('stroke-width', QUANTILE_STROKE_WIDTH)\r\n  }\r\n  // Draw labels\r\n  yAxis.append('text')\r\n    .attr('x', MARGIN.left - FONT_SIZE / 2)\r\n    .attr('y', MARGIN.top - FONT_SIZE / 2)\r\n    .attr('class', 'label')\r\n    .attr('text-anchor', 'end')\r\n    .text('Unité de données')\r\n    .attr('fill', '#898989')\r\n    .style('font-size', FONT_SIZE)\r\n\r\n  // ===================== CANDLES =====================\r\n\r\n  var bars = svg.append('g')\r\n    .attr('id', 'candles')\r\n\r\n  // HISTOGRAMME\r\n\r\n  /* for (let i = 0; i < data.quantileSets.length; i++) {\r\n    // Features of the histogram\r\n    var histogram = d3.histogram()\r\n      .domain(dataScale.domain())\r\n      .thresholds(dataScale.ticks(50)) // Important: how many bins approx are going to be made? It is the 'resolution' of the violin plot\r\n      .value(d => d)\r\n    const bins = histogram(data.quantileSets[i])\r\n    // What is the biggest number of value in a bin? We need it cause this value will have a width of 100% of the bandwidth.\r\n    var maxNum = 0\r\n    for (const bin of bins) {\r\n      if (bin.length > maxNum) {\r\n        maxNum = bin.length\r\n      }\r\n    }\r\n    // The maximum width of a violin must be x.bandwidth = the width dedicated to a group\r\n    var xNum = d3.scaleLinear()\r\n      .range([0, BAR_WIDTH])\r\n      .domain([-maxNum, maxNum])\r\n    // Add the shape to this svg!\r\n    const areaGenerator = d3.area()\r\n      .x0((d) => xNum(-d.length))\r\n      .x1((d) => xNum(d.length))\r\n      .y((d) => dataScale(d.x0))\r\n      .curve(d3.curveStep)\r\n    bars.append('path')\r\n      .attr('transform', `translate(${directionsScale(data.directions[i]) - BAR_WIDTH / 2})`)\r\n      .style('fill', '#69b3a2')\r\n      .attr('d', areaGenerator(bins))\r\n  } */\r\n\r\n  for (let i = 0; i < data.quantileSets.length; i++) {\r\n    const x = directionsScale(data.directions[i])\r\n    const top = dataScale(data.quantileSets[i][4])\r\n    const q3 = dataScale(data.quantileSets[i][3])\r\n    const q2 = dataScale(data.quantileSets[i][2])\r\n    const q1 = dataScale(data.quantileSets[i][1])\r\n    const bottom = dataScale(data.quantileSets[i][0])\r\n    // Draw domain line\r\n    bars.append('path')\r\n      .attr('d', d3.line()([[x, top], [x, bottom]]))\r\n      .attr('stroke', QUANTILE_STROKE_COLOR)\r\n      .attr('stroke-width', QUANTILE_STROKE_WIDTH)\r\n      .attr('class', `direction${i}`)\r\n    // Draw Q1 to Q3 bar\r\n    bars.append('rect')\r\n      .attr('width', BAR_WIDTH)\r\n      .attr('x', x - BAR_WIDTH / 2)\r\n      .attr('height', q1 - q3)\r\n      .attr('y', q3)\r\n      .attr('fill', QUANTILE_FILL_COLOR)\r\n      .attr('stroke', QUANTILE_STROKE_COLOR)\r\n      .attr('stroke-width', QUANTILE_STROKE_WIDTH)\r\n      .attr('class', `direction${i}`)\r\n    // Draw Q2 line\r\n    bars.append('path')\r\n      .attr('d', d3.line()([[x - BAR_WIDTH / 2, q2], [x + BAR_WIDTH / 2, q2]]))\r\n      .attr('stroke', QUANTILE_STROKE_COLOR)\r\n      .attr('stroke-width', QUANTILE_STROKE_WIDTH)\r\n      .attr('class', `direction${i}`)\r\n    // Draw quantile values\r\n    for (let j = 0; j < data.quantileSets[i].length; j++) {\r\n      const quantile = bars.append('g')\r\n        .attr('class', `direction${i} quantile`)\r\n        .style('visibility', 'hidden')\r\n      const x = directionsScale(data.directions[i]) + (i % 2 === 0 ? -1 : 1) * (BAR_WIDTH / 2 + FONT_SIZE / 2)\r\n      const y = dataScale(data.quantileSets[i][j])\r\n      quantile.append('text')\r\n        .attr('x', x)\r\n        .attr('y', y)\r\n        .attr('text-anchor', (i % 2 === 0 ? 'end' : 'start'))\r\n        .text(Math.round(data.quantileSets[i][j]))\r\n        .style('font-size', FONT_SIZE)\r\n        .attr('id', `quantile-text-${i}-${j}`)\r\n    }\r\n  }\r\n\r\n  // ===================== HOVER =====================\r\n\r\n  // Create triggers\r\n  for (let i = 0; i < data.directions.length; i++) {\r\n    bars.append('rect')\r\n      .attr('width', BAR_WIDTH)\r\n      .attr('x', directionsScale(data.directions[i]) - BAR_WIDTH / 2)\r\n      .attr('height', dataScale.range()[0] - dataScale.range()[1] + FONT_SIZE)\r\n      .attr('y', MARGIN.top)\r\n      .attr('fill', 'transparent')\r\n      // Highlight direction\r\n      .on('mouseover', () => {\r\n        d3.selectAll(`.direction${i}`)\r\n          .attr('stroke-width', QUANTILE_STROKE_WIDTH * 2)\r\n        d3.selectAll(`.direction${i}.label`)\r\n          .attr(\"font-weight\", 1000)\r\n        d3.selectAll(`.direction${i}.quantile`)\r\n          .style('visibility', 'visible')\r\n      // Unhighlight direction\r\n      }).on('mouseout', () => {\r\n        d3.selectAll(`.direction${i}`)\r\n          .attr('stroke-width', QUANTILE_STROKE_WIDTH)\r\n        d3.selectAll(`.direction${i}.label`)\r\n        .attr(\"font-weight\", 0)\r\n        d3.selectAll(`.direction${i}.quantile`)\r\n          .style('visibility', 'hidden')\r\n      })\r\n  }\r\n\r\n  // ===================== OTHER =====================\r\n\r\n  // Draw Title\r\n  svg.append('text')\r\n    .attr('x', (WIDTH - MARGIN.right - MARGIN.left) / 2 + MARGIN.left)\r\n    .attr('y', MARGIN.top - FONT_SIZE * 2)\r\n    .attr('text-anchor', 'middle')\r\n    .text(data.title)\r\n    .style('font-size', FONT_SIZE)\r\n\r\n  return [svg, dataScale]\r\n}\r\n\r\n/**\r\n * @param {object} vizData Project data\r\n * @returns {Array<number>} The quantile sets\r\n */\r\nexport function getDelayQuantileSets (vizData) {\r\n  const quantileSets = []\r\n  for (const line of vizData) {\r\n    for (const direction of line.girouettes) {\r\n      const delays = []\r\n      for (const trip of direction.voyages) {\r\n        for (const stop of trip.arrets) {\r\n          delays.push(stop.moyMinutesEcart)\r\n        }\r\n      }\r\n      quantileSets.push(helper.getQuantiles(delays))\r\n    }\r\n  }\r\n  return quantileSets\r\n}\r\n\r\n/**\r\n * @param {object} vizData Project data\r\n * @returns {Array<number>} The quantile sets\r\n */\r\nexport function getTrafficQuantileSets (vizData) {\r\n  const quantileSets = []\r\n  for (const line of vizData) {\r\n    for (const direction of line.girouettes) {\r\n      const tripNClients = []\r\n      for (const trip of direction.voyages) {\r\n        let nClients = 0\r\n        for (const stop of trip.arrets) {\r\n          nClients += stop.moyNClients\r\n        }\r\n        tripNClients.push(nClients)\r\n      }\r\n      quantileSets.push(helper.getQuantiles(tripNClients))\r\n    }\r\n  }\r\n  return quantileSets\r\n}\r\n","'use strict'\r\n\r\nimport * as helper from './scripts/helper.js'\r\nimport * as preprocess from './scripts/preprocess.js'\r\nimport * as groupedQuantile from './scripts/grouped-quantile.js'\r\n\r\n/**\r\n * @file \r\n * @author Adam Prévost, Armelle Jézéquel, Clara Serruau, Jules Lefebvre, Julien Dupuis\r\n * @version 1.0.0\r\n * \r\n * La structure du projet est inspirée de celle employé pour les TPs de INF8808 créée par Olivia Gélinas.\r\n */\r\n\r\n(function (d3) {\r\n  const svgSize = {\r\n    width: 800,\r\n    height: 625\r\n  }\r\n\r\n  helper.setCanvasSize(svgSize.width, svgSize.height)\r\n  helper.generateMapG(svgSize.width, svgSize.height)\r\n  helper.generateMarkerG(svgSize.width, svgSize.height)\r\n  helper.appendGraphLabels(d3.select('.main-svg'))\r\n  helper.initPanelDiv()\r\n\r\n  // Solution temporaire, éventuellement l'utilisateur peut choisir la période qui l'intéresse, s'il veut inclure les week-end et les fériés.\r\n  const startDate = new Date('2021-09-01')\r\n  const endDate = new Date('2021-12-01')\r\n  const typeJour = 'semaine'\r\n  const ferie = false\r\n\r\n  var vizData = []\r\n\r\n  build()\r\n\r\n  /**\r\n   *   Cette fonction construit la page web\r\n   */\r\n  function build () {\r\n    d3.csv('./donnees_L9_L22.csv').then(function (csvData) {\r\n      // Change les string pour les types appropriés\r\n      csvData.forEach(function (d) {\r\n        d.date = new Date(d.date + ' 00:00:00')\r\n        d.ligne = +d.ligne\r\n        d.voyage = +d.voyage\r\n        d.arret_code = +d.arret_code\r\n        d.montants = +d.montants\r\n        d.Minutes_ecart_planifie = +d.Minutes_ecart_planifie\r\n        d.sequence_arret = +d.sequence_arret\r\n        d.arret_Latitude = +d.arret_Latitude\r\n        d.arret_Longitude = +d.arret_Longitude\r\n      })\r\n      //console.log(csvData)\r\n      preprocess.addDayType(csvData)\r\n      preprocess.aggregateData(csvData, vizData, startDate, endDate, typeJour, ferie)\r\n      \r\n      groupedQuantile.generateViz3(vizData);\r\n    })\r\n  }\r\n})(d3)\r\n"]}